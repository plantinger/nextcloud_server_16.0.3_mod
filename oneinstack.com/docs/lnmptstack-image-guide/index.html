<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>多语言环境镜像使用手册</title>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">

    <link rel="stylesheet" type="text/css" href="https://oneinstack.com/wp-content/plugins/xdocs/themes/theme1/assets/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://oneinstack.com/wp-content/plugins/xdocs/themes/theme1/assets/css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="https://oneinstack.com/wp-content/plugins/xdocs/themes/theme1/assets/css/prism.css">
    <link rel="stylesheet" type="text/css" href="https://oneinstack.com/wp-content/plugins/xdocs/themes/theme1/assets/css/layout.css">
    <link rel="stylesheet" type="text/css" href="https://oneinstack.com/wp-content/plugins/xdocs/themes/theme1/assets/css/skin-blue.css">

    <link rel="stylesheet" type="text/css" href="https://oneinstack.com/wp-content/plugins/xdocs/themes/theme1/assets/css/style.css">

    <!-- All dynamic styles -->
        <style type="text/css">
        
    </style>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
              <style>
            .xdocs-pre-loader{
                background: url(https://oneinstack.com/wp-content/plugins/xdocs/assets/img/loader4.gif) center no-repeat #fff;
            }
        </style>

          </head>
  <body class="skin-blue fixed" data-spy="scroll" data-target="#scrollspy">


    
    <div class="xdocs-pre-loader"></div>    <div class="wrapper">
      <header class="main-header">
          <!-- Sidebar toggle button-->
          <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
            <span class="sr-only">Toggle navigation</span>
          </a>
      </header>
      <!-- Left side column. contains the logo and sidebar --><aside class="main-sidebar">
    
  <!-- sidebar: style can be found in sidebar.less -->
  <div class="sidebar" id="scrollspy">
    <!-- sidebar menu: : style can be found in sidebar.less -->
    <ul class="nav sidebar-menu">
      <li class="active"><a href="#introduction">Introduction</a>

                  
                 
                   <li class="treeview" id="scrollspy-components"><a href="#">镜像说明</a>
                  <ul class="nav treeview-menu"><li class=""><a href="#111">版本说明</a><li class=""><a href="#112">目录说明</a><li class=""><a href="#113">参数优化</a></ul>                </li>

              
              
                 
                   <li class="treeview" id="scrollspy-components"><a href="#">版本切换</a>
                  <ul class="nav treeview-menu"><li class=""><a href="#121">PHP版本切换</a><li class=""><a href="#122">JDK版本切换</a></ul>                </li>

              
              
                             

               <li class=""><a href="#13">将网站数据迁移至数据云盘</a>

                    
              
                 
                   <li class="treeview" id="scrollspy-components"><a href="#">MySQL数据库管理</a>
                  <ul class="nav treeview-menu"><li class=""><a href="#141">数据库默认root密码</a><li class=""><a href="#142">重置数据库root密码</a><li class=""><a href="#143">创建一个数据库</a><li class=""><a href="#144">删除一个数据库</a><li class=""><a href="#145">创建数据库用户</a><li class=""><a href="#146">如何配置MySQL远程连接</a></ul>                </li>

              
              
                 
                   <li class="treeview" id="scrollspy-components"><a href="#">如何管理虚拟主机</a>
                  <ul class="nav treeview-menu"><li class=""><a href="#151">添加虚拟主机</a><li class=""><a href="#152">删除虚拟主机</a></ul>                </li>

              
              
                             

               <li class=""><a href="#16">如何管理FTP账号</a>

                    
              
                             

               <li class=""><a href="#17">如何备份</a>

                    
              
                             

               <li class=""><a href="#18">如何管理服务</a>

                    
              
                             

               <li class=""><a href="#19">如何升级版本</a>

                    
              
                             

               <li class=""><a href="#20">如何添加附加组件</a>

                    
              
                             

               <li class=""><a href="#21">如何卸载</a>

                    
              
                 
                   <li class="treeview" id="scrollspy-components"><a href="#">更多</a>
                  <ul class="nav treeview-menu"><li class=""><a href="#221">如何部署一PHP网站</a><li class=""><a href="#222">如何部署一个JAVA网站</a><li class=""><a href="#223">关于PHP缓存（Opcache）</a><li class=""><a href="#224">关于网站根目录权限</a><li class=""><a href="#225">关于Redis、Memcached</a><li class=""><a href="#226">关于iptables防火墙</a></ul>                </li>

              
              
            </ul>
          </div>
    </aside>
<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
    <!-- Main content -->
    <div class="content body">


         <!-- Introduction Section -->
          <section id="introduction">
            <div class='section-content'>
              <div class="content-header">
                <h1>多语言环境镜像使用手册</h1>
                              <div class="version"> Version 1.7</div>
                       </div>
              <div class="row">
                <div class="col-sm-12">
                                   </div>
              </div>
              <div class="row">
                  <div class="col-sm-12">
                     <ul>
<li>执行命令，建议手敲，复制命令不能识别</li>
<li>支持备份（包含本地、远程、OSS、COS、七牛云、upyun）等功能</li>
<li>未经容许，禁止盗用图片，文档和代码不能复制传播</li>
<li>快速部署PHP网站：《<a href="https://oneinstack.com/docs/lnmptstack-image-guide/#221" target="_blank" rel="noopener noreferrer">如何部署一个PHP网站?</a>》</li>
<li>快速部署JAVA网站：《<a href="https://oneinstack.com/docs/lnmptstack-image-guide/#222" target="_blank" rel="noopener noreferrer">如何部署一个JAVA网站?</a>》</li>
<li>注意：安全组端口（80、443、21、20000～30000）是否打开，参考： <a href="https://oneinstack.com/docs/securitygroup/" target="_blank" rel="noopener">https://oneinstack.com/docs/securitygroup/</a></li>
</ul>
                  </div>
              </div>
            </div>
          </section>
          <!-- End Introduction Section -->


  <section id="11" class="stickem-container">
  <div class='section-content'><h2 class='page-header'><a href='#11' class='header-link'><i class='fa fa-link'></i></a>镜像说明</h2><div id='111' class='step-content clearfix'><h3 class='steps-header'><a href='#111'>版本说明</a></h3><p>软件版本详细：</p>
<ul>
<li>Nginx1.12.2</li>
<li>Tomcat8.5.30</li>
<li>PHP7.2.4、7.1.4、7.0.29、5.6.35、5.5.538、5.4.45、5.3.29</li>
<li>MySQL5.7.21</li>
<li>Redis4.0.9</li>
<li>Memcached1.5.7</li>
<li>Jemalloc5.0.1</li>
<li>Pure-FTPd1.0.47</li>
<li>phpMyAdmin4.4.15.10</li>
</ul>
<p>功能亮点：</p>
<ol>
<li>基于源码编译安装，细节安全优化，纯命令行，占用系统资源低</li>
<li>Jemalloc优化MySQL、Nginx内存管理</li>
<li>PHP环境：Nginx+php-fpm的组合（即LNMP）</li>
<li>JAVA环境：Nginx+Tomcat的组合，动静分离，性能更加高效，适用于对访问量要求较高的站点； Tomcat以一般用户运行、隐藏版本号等，增强安全性，Tomcat以apr模式运行，大幅度的提高性能</li>
<li>交互添加Nginx、Tomcat虚拟主机，提供java、php选项一键创建虚拟主机，支持Let&#8217;s Encrypt一键设置</li>
<li>菜单式FTP账号管理脚本，轻松建立ftp虚拟用户</li>
<li>提供在线Nginx、PHP、MySQL、Redis、Memcached、phpMyAdmin升级脚本</li>
<li>提供本地备份和远程备份（服务器之间rsync）、OSS、COS、UPYUN备份功能</li>
</ol>
<p>&nbsp;</p>
</div><div id='112' class='step-content clearfix'><h3 class='steps-header'><a href='#112'>目录说明</a></h3><p>源码安装目录：<br />
Nginx：/usr/local/nginx<br />
Tomcat：/usr/local/tomcat<br />
JDK: /usr/java<br />
PHP：/usr/local/php<br />
MySQL：/usr/local/mysql<br />
Pureftpd：/usr/local/pureftpd<br />
Redis： /usr/local/redis<br />
Memcached：/usr/local/memcached<br />
phpMyAdmin：/data/wwwroot/default/phpMyAdmin</p>
<p>数据存储目录：<br />
数据库（MySQL）：/data/mysql<br />
网站根目录：/data/wwwroot/www.example.com  #<a href="#151">添加虚拟主机</a>会自动创建这个目录<br />
Web访问日志：/data/wwwlogs</p>
<p>默认ip直接访问内容对应根目录：/data/wwwroot/default，该目录包含首页demo、Opcache缓存管理、phpinfo、phpmyadmin、探针等文件，目录里面文件可删除，目录不能删除。</p>
<p>首页demo：http://公网IP<br />
PHPINFO地址：http://公网IP/phpinfo.php<br />
Opcache地址：http://公网IP/ocp.php<br />
phpmyadmin管理地址：http://公网IP/phpMyAdmin  #建议用chrome浏览器，访问注意大小写，为了安全建议重命名或者删除<br />
PHP运行环境探针地址：http://公网IP/tz.php</p>
</div><div id='113' class='step-content clearfix'><h3 class='steps-header'><a href='#113'>参数优化</a></h3><p>由于镜像制作是下1核1G内存配置完成，Nginx、MySQL、PHP、JVM参数还是该配置的参数，强烈建议如果不是这个配置，请执行下面优化脚本：</p>
<pre><code class="language-bash">cd /root/oneinstack  #必须进入oneinstack目录下执行
./optimize.sh      #请勿bash ./optimize.sh（或者sh）这样执行</code></pre>
<p>⚠️注意：</p>
<ol>
<li>可能需要等待1分钟，请勿中断</li>
<li>此脚本会根据系统配置，自动优化Nginx、MySQL、PHP、JVM等参数</li>
</ol>
<p>如下图：<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/optimize.png" /></p>
</div></div><div class='stickem'><ul class='steps'><li><a href='#111'>1</a></li><li><a href='#112'>2</a></li><li><a href='#113'>3</a></li></ul></div>  </section>

  <section id="12" class="stickem-container">
  <div class='section-content'><h2 class='page-header'><a href='#12' class='header-link'><i class='fa fa-link'></i></a>版本切换</h2><div id='121' class='step-content clearfix'><h3 class='steps-header'><a href='#121'>PHP版本切换</a></h3><pre><code class="language-bash">cd /root/oneinstack
./change_php_version.sh</code></pre>
<p>如下图：<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/change_php_version_cn.png" /></p>
</div><div id='122' class='step-content clearfix'><h3 class='steps-header'><a href='#122'>JDK版本切换</a></h3><pre><code class="language-bash">cd /root/oneinstack
./change_jdk_version.sh</code></pre>
<p>如下图：<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/change_jdk_version_cn.png" /></p>
</div></div><div class='stickem'><ul class='steps'><li><a href='#121'>1</a></li><li><a href='#122'>2</a></li></ul></div>  </section>

  <section id="13" class="stickem-container">
  <div class='section-content'><h2 class='page-header'><a href='#13' class='header-link'><i class='fa fa-link'></i></a>将网站数据迁移至数据云盘</h2><p>⚠️注意：如果您购买了数据云盘（脚本仅支持未本地挂载磁盘），建议先挂载数据云盘，将网站内容、数据库放在数据云盘中，<span style="color: #ff0000;">未购买数据云盘请忽略该教程！</span></p>
<pre><code class="language-bash">cd /root/oneinstack
./move_auto_fdisk.sh</code></pre>
<p>如下图：<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/move_auto_fdisk.png" /></p>
</div>  </section>

  <section id="14" class="stickem-container">
  <div class='section-content'><h2 class='page-header'><a href='#14' class='header-link'><i class='fa fa-link'></i></a>MySQL数据库管理</h2><p>注：也可以通过phpMyAdmin来管理数据库</p>
<div id='141' class='step-content clearfix'><h3 class='steps-header'><a href='#141'>数据库默认root密码</a></h3><pre><code class="language-bash">cd  /root/oneinstack
grep dbrootpwd options.conf  #显示数据库root密码</code></pre>
<p>如下图：<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/dbrootpwd.png" /></p>
</div><div id='142' class='step-content clearfix'><h3 class='steps-header'><a href='#142'>重置数据库root密码</a></h3><pre><code class="language-bash">cd /root/oneinstack
./reset_db_root_password.sh
</code></pre>
<p>如下图：<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/reset_db_root_password_cn.png" /></p>
</div><div id='143' class='step-content clearfix'><h3 class='steps-header'><a href='#143'>创建一个数据库</a></h3><p>创建数据库有2种方法<br />
<strong>方法一：命令行创建</strong><br />
如：创建oneinstack的数据库（举例）<br />
# mysql -uroot –p #进入数据库控制台<br />
Enter password: #数据库root密码，⚠️输入密码不显示在屏幕上<br />
MySQL [(none)]&gt; create database oneinstack; #特别注意有分号<br />
MySQL [(none)]&gt; show databases; #查看数据库，除oneinstack数据库，其它3个为系统默认库，不能删除<br />
MySQL [(none)]&gt; exit; #退出数据库控制台，特别注意有分号<br />
如下图：<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/createdb_cn.png" /><br />
<strong>方法二：phpMyAdmin创建</strong><br />
1. 浏览器输入http://公网IP/phpMyAdmin<br />
⚠️浏览器建议用谷歌或火狐，否则可能会报错，注意phpMyAdmin大小写<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/phpmyadminlogin_cn.png" /><br />
2. 按照下图创建数据库<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/phpmyadmincreatedb_cn.png" /></p>
</div><div id='144' class='step-content clearfix'><h3 class='steps-header'><a href='#144'>删除一个数据库</a></h3><p>删除数据库同样有2种方法<br />
<strong>方法一：命令行删除</strong><br />
如：删除oneinstack的数据库（举例）<br />
# mysql -uroot –p #进入数据库控制台<br />
Enter password: #数据库root密码，⚠️输入密码不显示在屏幕上<br />
MySQL [(none)]&gt; drop database oneinstack;<br />
MySQL [(none)]&gt; show databases; #查看数据库<br />
MySQL [(none)]&gt; exit; #退出数据库控制台，特别注意有分号<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/dropdb_cn.png" /><br />
<strong>方法二：phpMyAdmin删除</strong><br />
1. 浏览器输入http://公网IP/phpMyAdmin<br />
⚠️浏览器建议用谷歌或火狐，否则可能会报错，注意phpMyAdmin大小写<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/phpmyadminlogin_cn.png" /><br />
2. 按照下图创建数据库<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/phpmyadmindropdb_cn.png" /></p>
</div><div id='145' class='step-content clearfix'><h3 class='steps-header'><a href='#145'>创建数据库用户</a></h3><p>为了安全我们通常给每一个网站程序建立唯一的数据库连接帐号（帐号名不能为root）。<br />
如：添加一个用户名为db_user，密码为db_pass，授权为本机localhost对db_name数据库所有权限，命令如下<br />
# mysql -uroot –p<br />
Enter password: #输入数据库的root密码，默认不显示密码<br />
MySQL [(none)]&gt; grant all privileges on db_name.* to db_user@&#8217;localhost&#8217; identified by &#8216;db_pass&#8217;; #授权语句，特别注意有分号<br />
MySQL [(none)]&gt; flush privileges; #权限立即生效<br />
MySQL [(none)]&gt; exit; #退出数据库控制台，特别注意有分号<br />
如下图：<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/createuser_cn.png" /></p>
</div><div id='146' class='step-content clearfix'><h3 class='steps-header'><a href='#146'>如何配置MySQL远程连接</a></h3><p>为了安全考虑，OneinStack仅允许云主机本机（localhost）连接数据库，如果需要远程连接数据库，需要如下操作：<br />
⚠️注意：云主机安全组端口（如云厂商控制台）、iptables（部分云主机没有启用iptables，可跳过）、grant授权用户，缺一不可<br />
<strong>1. 云主机安全组端口开放3306端口</strong><br />
参考文档：《<a href="https://oneinstack.com/docs/securitygroup/" target="_blank" rel="noopener">云主机安全组端口开放教程</a>》<br />
<strong>2. </strong><strong>打开iptables 3306端口</strong><br />
如果您的操作系统为CentOS系列：</p>
<pre><code class="language-bash">iptables -I INPUT 4 -p tcp -m state --state NEW -m tcp --dport 3306 -j ACCEPT
service iptables save #保存iptables规则</code></pre>
<p>如下图：<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/centos_iptables3306_cn.png" /><br />
如果您的操作系统为Ubuntu/Debian系列：</p>
<pre><code class="language-bash">iptables -I INPUT 4 -p tcp -m state --state NEW -m tcp --dport 3306 -j ACCEPT
iptables-save &gt; /etc/iptables.up.rules  #保存iptables规则</code></pre>
<p>如下图：<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/ubuntu_debian_iptables3306_cn.png" /><br />
<strong>3. 数据库授权</strong><br />
远程连接新建一个帐号（帐号名不能为root）。<br />
如：添加一个用户名为db_user，密码为db_pass，授权为% （%表示所有外围IP能连接）对db_name数据库所有权限，命令如下<br />
# mysql -uroot -p<br />
MySQL [(none)]&gt; grant all privileges on db_name.* to db_user@&#8217;%&#8217; identified by &#8216;db_pass&#8217;; #授权语句，特别注意有分号<br />
MySQL [(none)]&gt; flush privileges;<br />
MySQL [(none)]&gt; exit; #退出数据库控制台，特别注意有分号<br />
如下图：<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/createuserall_cn.png" /></p>
</div></div><div class='stickem'><ul class='steps'><li><a href='#141'>1</a></li><li><a href='#142'>2</a></li><li><a href='#143'>3</a></li><li><a href='#144'>4</a></li><li><a href='#145'>5</a></li><li><a href='#146'>6</a></li></ul></div>  </section>

  <section id="15" class="stickem-container">
  <div class='section-content'><h2 class='page-header'><a href='#15' class='header-link'><i class='fa fa-link'></i></a>如何管理虚拟主机</h2><div id='151' class='step-content clearfix'><h3 class='steps-header'><a href='#151'>添加虚拟主机</a></h3><pre><code class="language-bash">cd /root/oneinstack
./vhost.sh
</code></pre>
<p>创建PHP环境如下图：<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/lnmptphpvhost_cn.png" /><br />
创建JAVA环境如下图：<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/lnmptjavavhost_cn.png" /><br />
图中directory为网站根目录，脚本执行后会自动创建，部署网站时请将代码上传到该目录（目录、子目录和文件权限都为：www）<br />
对应Nginx配置文件路径：<br />
/usr/local/nginx/conf/vhost/demo.oneinstack.com.conf<br />
伪静态（只有LNMP环境才会出现伪静态选项）：/usr/local/nginx/conf/rewrite/wordpress.conf<br />
对应Tomcat配置文件路径：<br />
/usr/local/tomcat/conf/vhost/demo.oneinstack.com.xml</p>
</div><div id='152' class='step-content clearfix'><h3 class='steps-header'><a href='#152'>删除虚拟主机</a></h3><pre><code class="language-bash">cd /root/oneinstack
./vhost.sh del
</code></pre>
<p>如下图：<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/vhostdel_cn.png" /></p>
</div></div><div class='stickem'><ul class='steps'><li><a href='#151'>1</a></li><li><a href='#152'>2</a></li></ul></div>  </section>

  <section id="16" class="stickem-container">
  <div class='section-content'><h2 class='page-header'><a href='#16' class='header-link'><i class='fa fa-link'></i></a>如何管理FTP账号</h2><pre><code class="language-bash">cd /root/oneinstack
./pureftpd_vhost.sh</code></pre>
<p>如下图：<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/pureftpd_cn.png" /></p>
</div>  </section>

  <section id="17" class="stickem-container">
  <div class='section-content'><h2 class='page-header'><a href='#17' class='header-link'><i class='fa fa-link'></i></a>如何备份</h2><p><strong>设置备份参数</strong></p>
<pre><code class="language-bash">cd /root/oneinstack
./backup_setup.sh</code></pre>
<p>如下图：<br />
<img class="aligncenter size-medium" src="https://static.oneinstack.com/images/backup_setup.png" /><br />
<strong>立即备份</strong></p>
<pre><code class="language-bash">cd /root/oneinstack
./backup.sh</code></pre>
<p><strong>设置计划任务自动定时备份</strong><br />
如：每天凌晨一点备份，注：下面命令请勿重复执行</p>
<pre><code class="language-bash">echo '0 1 * * * cd ~/oneinstack;./backup.sh &gt; /dev/null 2&gt;&amp;1 &amp; ' &gt;&gt; /var/spool/cron/root</code></pre>
<p><strong>查看本地备份</strong></p>
<pre><code class="language-bash">ls -l /data/backup</code></pre>
<p>如下图：<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/backup_local.png" /><br />
<strong>如果设置远程云存储备份，查看某云存储</strong><br />
登陆某云管理控制台<br />
如下图：<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/backup_oss.png" /></p>
</div>  </section>

  <section id="18" class="stickem-container">
  <div class='section-content'><h2 class='page-header'><a href='#18' class='header-link'><i class='fa fa-link'></i></a>如何管理服务</h2><p>Nginx:</p>
<pre><code class="language-bash">service nginx {start|stop|status|restart|reload|configtest}</code></pre>
<p>⚠️：更改Nginx配置文件，强烈建议reload<br />
Tomcat:</p>
<pre><code class="language-bash">service tomcat {start|stop|restart|status}</code></pre>
<p>PHP:</p>
<pre><code class="language-bash">service php-fpm {start|stop|restart|reload|status}</code></pre>
<p>MySQL:</p>
<pre><code class="language-bash">service mysqld {start|stop|restart|reload|status}</code></pre>
<p>Pure-Ftpd:</p>
<pre><code class="language-bash">service pureftpd {start|stop|restart|status}</code></pre>
<p>Redis:</p>
<pre><code class="language-bash">service redis-server {start|stop|status|restart|reload}</code></pre>
<p>Memcached:</p>
<pre><code class="language-bash">service memcached {start|stop|status|restart|reload}</code></pre>
</div>  </section>

  <section id="19" class="stickem-container">
  <div class='section-content'><h2 class='page-header'><a href='#19' class='header-link'><i class='fa fa-link'></i></a>如何升级版本</h2><pre><code class="language-bash">cd /root/oneinstack
./upgrade.sh</code></pre>
<p>如下图：<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/upgrade_cn.png" /></p>
</div>  </section>

  <section id="20" class="stickem-container">
  <div class='section-content'><h2 class='page-header'><a href='#20' class='header-link'><i class='fa fa-link'></i></a>如何添加附加组件</h2><pre><code class="language-bash">cd /root/oneinstack
./addons.sh   #注：支持安装、卸载功能</code></pre>
<p>如下图：<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/addons_cn.png" /></p>
</div>  </section>

  <section id="21" class="stickem-container">
  <div class='section-content'><h2 class='page-header'><a href='#21' class='header-link'><i class='fa fa-link'></i></a>如何卸载</h2><p>⚠️可单独卸载某些项，如数据库用RDS，可单独卸载数据库</p>
<pre><code class="language-bash">cd /root/oneinstack
./uninstall.sh   #特别注意备份数据</code></pre>
<p>如下图：<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/uninstall_cn.png" /></p>
</div>  </section>

  <section id="22" class="stickem-container">
  <div class='section-content'><h2 class='page-header'><a href='#22' class='header-link'><i class='fa fa-link'></i></a>更多</h2><div id='221' class='step-content clearfix'><h3 class='steps-header'><a href='#221'>如何部署一PHP网站</a></h3><ol>
<li>创建该网站所需的数据库，参考《<a href="#143">创建一个数据库</a>》</li>
<li>添加PHP虚拟主机，参考《<a href="#151">如何添加虚拟主机</a>》</li>
<li>创建FTP账号，参考《<a href="#16">如何管理FTP账号</a>》</li>
<li>部署代码到网站根目录</li>
</ol>
<p><strong>注意：</strong>通过ftp上传代码不需要修改权限，默认已经是www；在服务器里面下载代码必须修改网站根目录及子、目录文件权限都为www；如网站权限出现问题，请参考《<a href="#224">关于网站根目录权限</a>》</p>
<p>如下wget下载代码部署一个<a href="https://cn.wordpress.org/" target="_blank" rel="noopener noreferrer">wordpress</a>，如下图：<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/wordpress_download_cn.png" /><br />
访问http://demo.oneinstack.com，输入数据库地址（localhost）， 用户名（root），密码（数据库root密码），完成。<br />
如下图：<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/wordpress_dbinfo_cn.png" /></p>
</div><div id='222' class='step-content clearfix'><h3 class='steps-header'><a href='#222'>如何部署一个JAVA网站</a></h3><ol>
<li>创建该网站所需的数据库，参考《<a href="#143">创建一个数据库</a>》</li>
<li>添加虚拟主机，参考《<a href="#151">如何添加虚拟主机</a>》</li>
<li>创建FTP账号，参考《<a href="#16">如何管理FTP账号</a>》</li>
<li>部署代码到网站根目录</li>
</ol>
<p><strong>注意：</strong></p>
<p>通过ftp上传代码不需要修改权限，默认已经是www；在服务器里面下载代码必须修改网站根目录及子、目录文件权限都为www；如网站权限出现问题，请参考《<a href="#222">关于网站根目录权限</a>》<br />
如下图：<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/javademo_cn.png" /><br />
访问http://demo.oneinstack.com，输入数据库地址（localhost）， 用户名（root），密码（数据库root密码），完成。</p>
<p><strong>JAVA应用部署说明</strong><br />
默认镜像是做了动静分离，即nginx处理静态资源（jss、ccc、图片等），其余的交给tomcat处理。<br />
默认（未绑定域名）对应网站根目录/data/wwwroot/default（不是webapps），部署代码时建议将war包解压（比如example.war，解压命令：jar xf example.war ，注意权限必须为www），将其中代码放到对应网站根目录。<br />
• 如果上传代码之后目录结构为:/data/wwwroot/default/WEB-INF，访问地址为：http://IP<br />
• 如果上传代码之后目录结构为:/data/wwwroot/default/example/WEB-INF，访问网站地址为：http://IP/example。</p>
<p><strong>注意：</strong></p>
<ul>
<li>war包也可以不解压即上传到对应网站根目录，但必须注意访问路径和静态资源目录问题。如果访问网站时，静态资源加载不了，可能是原因是做了动静分离静态资源直接有nginx处理，请确认nginx是否能找到相关静态资源（nginx网站根目录:/data/wwwroot/default）</li>
<li>如果vhost.sh绑定了域名，如www.example.com，工具会自动生成对应根目录:/data/wwwroot/www.example.com ，请将代码放入此目录。</li>
<li>Tomcat参数请修改: /usr/local/tomcat/bin/setenv.sh</li>
</ul>
</div><div id='223' class='step-content clearfix'><h3 class='steps-header'><a href='#223'>关于PHP缓存（Opcache）</a></h3><p>默认情况下，为了减少PHP编译时间，提高性能（生产环境强烈开启Opcache），微柳提供的PHP环境默认加载了Opcache模块（PHP5.5、5.6、7.0、7.1），关于原理请参考：《<a href="https://blog.linuxeye.com/361.html" target="_blank" rel="noopener noreferrer">深入理解PHP Opcode缓存原理</a>》<br />
但是这样会出现PHP代码更新后，需要2～3分钟才能生效，这样影响工作效率，在网站调试阶段建议您关闭或者每次有代码更新刷新缓存（推荐方法二）<br />
<strong>方法一：卸载Opcache</strong></p>
<pre><code class="language-bash">cd /root/oneinstack
./addons.sh</code></pre>
<p><img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/uninstallopcache_cn.png" /><br />
<strong>方法二：刷新PHP缓存</strong><br />
访问http://公网IP/ocp.php，或者直接访问http://公网IP/ocp.php?RESET=1<br />
如下图：<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/resetocp_cn.png" /></p>
</div><div id='224' class='step-content clearfix'><h3 class='steps-header'><a href='#224'>关于网站根目录权限</a></h3><p>网站根目录权限遵循：<br />
文件644， 文件夹755 ，权限用户和用户组www<br />
如出现文件权限问题时，请执行下面3条命令：</p>
<pre><code class="language-bash">chown -R www.www /data/wwwroot/
find /data/wwwroot/ -type d -exec chmod 755 {} \;
find /data/wwwroot/ -type f -exec chmod 644 {} \;</code></pre>
</div><div id='225' class='step-content clearfix'><h3 class='steps-header'><a href='#225'>关于Redis、Memcached</a></h3><p>Redis默认端口：6379<br />
Memcached默认端口：11211<br />
默认监听地址：127.0.0.1<br />
<strong>如果增加Redis最大内存大小?</strong><br />
vi /usr/local/redis/etc/redis.conf<br />
maxmemory 1024000000  #单位字节，默认1G，可调整<br />
service redis-server restart   #重启生效<br />
<strong>如果增加Memcached最大内存大小?</strong><br />
vi /etc/init.d/memcached<br />
CACHESIZE=256   #单位M，默认256M，可调整<br />
service memcached restart  #重启生效<br />
<strong>更改Redis监听端口</strong><br />
vi /usr/local/redis/etc/redis.conf<br />
bind 127.0.0.1  #改成bind 0.0.0.0，保存<br />
service redis-server restart   #重启生效<br />
<strong>更改Memcached监听端口</strong><br />
vi /etc/init.d/memcached<br />
OPTIONS=&#8221;-l 127.0.0.1&#8243; 改成OPTIONS=&#8221;&#8221;，保存<br />
service memcached restart  #重启生效</p>
</div><div id='226' class='step-content clearfix'><h3 class='steps-header'><a href='#226'>关于iptables防火墙</a></h3><p>默认情况下开通22（ssh）80、443（Nginx） 21、20000:30000（FTP）<br />
其它端口都拒绝，如下需要允许其它端口，请如下操作（如开启8080端口）<br />
<strong>如果您的操作系统为CentOS系列：</strong></p>
<pre><code class="language-bash">iptables -I INPUT 4 -p tcp -m state --state NEW -m tcp --dport 8080 -j ACCEPT
service iptables save #保存iptables规则</code></pre>
<p>如下图：<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/centos_iptables8080_cn.png" /><br />
<strong>如果您的操作系统为Ubuntu/Debian系列：</strong></p>
<pre><code class="language-bash">iptables -I INPUT 4 -p tcp -m state --state NEW -m tcp --dport 8080 -j ACCEPT
iptables-save &gt; /etc/iptables.up.rules  #保存iptables规则</code></pre>
<p>如下图：<br />
<img class="aligncenter size-medium" src="//static.oneinstack.com/images/docs/ubuntu_debian_iptables8080_cn.png" /></p>
</div></div><div class='stickem'><ul class='steps'><li><a href='#221'>1</a></li><li><a href='#222'>2</a></li><li><a href='#223'>3</a></li><li><a href='#224'>4</a></li><li><a href='#225'>5</a></li><li><a href='#226'>6</a></li></ul></div>  </section>

    </div><!-- /.content -->
</div><!-- /.content-wrapper -->
      

  <footer class="main-footer">

      <div class="pull-right hidden-xs">
                        <div class="version"> Version 1.7</div>
               </div>

    <div class="copyrights">Copyright © 2018 OneinStack.  All rights reserved.</div>  </footer>


</div><!-- ./wrapper -->


    <script type="text/javascript" src="https://oneinstack.com/wp-content/plugins/xdocs/themes/theme1/assets/js/jQuery-2.2.0.min.js"></script>
    <script type="text/javascript" src="https://oneinstack.com/wp-content/plugins/xdocs/themes/theme1/assets/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://oneinstack.com/wp-content/plugins/xdocs/themes/theme1/assets/js/app.js"></script>
    <script type="text/javascript" src="https://oneinstack.com/wp-content/plugins/xdocs/themes/theme1/assets/js/jquery.stickem.js"></script>
    <script type="text/javascript" src="https://oneinstack.com/wp-content/plugins/xdocs/themes/theme1/assets/js/jquery.slimscroll.min.js"></script>
    <script type="text/javascript" src="https://oneinstack.com/wp-content/plugins/xdocs/themes/theme1/assets/js/prism.js"></script>
    <script type="text/javascript" src="https://oneinstack.com/wp-content/plugins/xdocs/themes/theme1/assets/js/docs.js"></script>
    </body>
</html>